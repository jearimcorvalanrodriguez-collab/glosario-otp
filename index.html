<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glosario para Tripulantes de Cabina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root { --latam-blue-dark: #002D62; --latam-blue-light: #00A3E0; --latam-bg: #f4f6f8; }
        body { font-family: 'Inter', sans-serif; background-color: var(--latam-bg); }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: var(--latam-blue-dark); border-radius: 50%; width: 32px; height: 32px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #searchInput:focus { box-shadow: 0 0 0 3px rgba(0, 163, 224, 0.3); border-color: var(--latam-blue-light); }
        .glossary-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .glossary-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="antialiased">
    <div class="w-full bg-[var(--latam-blue-dark)]">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 md:px-8 py-8">
            <div class="text-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-white tracking-tight">Glosario de Cabina</h1>
                <p class="text-indigo-200 mt-2">Encuentra siglas y conceptos clave al instante.</p>
            </div>
            <div class="relative mt-8">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
                <input type="search" id="searchInput" placeholder="Buscar término, definición..." class="w-full pl-12 pr-4 py-3 rounded-full text-gray-800 placeholder-gray-500 border-2 border-transparent focus:outline-none transition">
            </div>
        </div>
    </div>
    
    <main class="max-w-3xl mx-auto px-4 sm:px-6 md:px-8 py-6 -mt-8">
        <div id="resultsContainer" class="space-y-4"></div>
        <template id="loadingTemplate"><div class="text-center py-12"><div class="spinner mx-auto"></div><p class="mt-4 text-gray-500">Cargando glosario...</p></div></template>
        <template id="errorTemplate"><div class="text-center py-12 px-4 bg-red-50 rounded-lg"><h3 class="font-bold text-lg text-red-700">¡Error de Carga!</h3><p id="errorMessage" class="mt-1 text-red-600">No se pudieron obtener los datos.</p></div></template>
        <template id="noResultsTemplate"><div class="text-center py-12 px-4 bg-white rounded-lg shadow-sm"><h3 class="font-semibold text-lg text-gray-700">Sin Resultados</h3><p class="mt-1 text-gray-500">No se encontraron términos que coincidan con tu búsqueda.</p></div></template>
    </main>

    <script>
        // Esta función global será llamada por el script de Google
        function handleData(data) {
            if (data.error) {
                console.error("Error desde Apps Script:", data.error);
                showState('error', data.error);
                return;
            }
            
            glossaryData = data.sort((a, b) => (a.term || '').localeCompare(b.term || ''));
            renderGlossary(glossaryData);
        }

        let glossaryData = [];
        const searchInput = document.getElementById("searchInput");
        const resultsContainer = document.getElementById("resultsContainer");
        const templates = { loading: document.getElementById("loadingTemplate"), error: document.getElementById("errorTemplate"), noResults: document.getElementById("noResultsTemplate") };

        const showState = (state, message = '') => {
            resultsContainer.innerHTML = '';
            const template = templates[state];
            if (template) {
                const clone = template.content.cloneNode(true);
                if (state === 'error' && message) {
                    clone.querySelector('#errorMessage').textContent = message;
                }
                resultsContainer.appendChild(clone);
            }
        };

        const renderGlossary = (data) => {
            resultsContainer.innerHTML = '';
            if (data.length === 0) { showState('noResults'); return; }
            
            const groupedData = data.reduce((acc, item) => {
                const area = item.area || 'General';
                if (!acc[area]) acc[area] = [];
                acc[area].push(item);
                return acc;
            }, {});

            for (const area in groupedData) {
                const areaTitle = document.createElement('h2');
                areaTitle.className = 'text-xl font-bold text-[var(--latam-blue-dark)] tracking-wide pt-4 pb-2';
                areaTitle.textContent = area;
                resultsContainer.appendChild(areaTitle);
                
                groupedData[area].forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'glossary-card bg-white rounded-lg shadow-md p-5 overflow-hidden';
                    const termElement = document.createElement('h3');
                    termElement.className = 'text-lg font-bold text-[var(--latam-blue-light)]';
                    termElement.textContent = item.term || '';
                    const definitionElement = document.createElement('p');
                    definitionElement.className = 'text-gray-600 mt-2';
                    definitionElement.textContent = item.definition || '';
                    card.appendChild(termElement);
                    card.appendChild(definitionElement);
                    if (item.keywords) {
                        const keywordsContainer = document.createElement('div');
                        keywordsContainer.className = 'mt-4 border-t pt-3';
                        keywordsContainer.innerHTML = `<span class="text-xs font-semibold text-gray-400 uppercase">Palabras Clave: </span><span class="text-sm text-gray-500 italic">${item.keywords}</span>`;
                        card.appendChild(keywordsContainer);
                    }
                    resultsContainer.appendChild(card);
                });
            }
        };

        const filterAndRender = () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredData = glossaryData.filter(item => Object.values(item).some(val => String(val).toLowerCase().includes(searchTerm)));
            renderGlossary(filteredData);
        };
        
        const debounce = (func, delay = 250) => {
            let timeoutId;
            return (...args) => { clearTimeout(timeoutId); timeoutId = setTimeout(() => func.apply(this, args), delay); };
        };

        document.addEventListener("DOMContentLoaded", () => {
            showState('loading');
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxQKn2w8eHvnmo6y0wwQkOxXCnApcDTTmw7uILMAnAUPFlfvYJZGu3A36MB98PGOQ8w9w/exec';
            
            // Técnica JSONP
            const scriptTag = document.createElement('script');
            scriptTag.src = `${WEB_APP_URL}?callback=handleData`;
            scriptTag.onerror = () => handleData({ error: 'Fallo al cargar el script desde Google.' });
            document.body.appendChild(scriptTag);

            searchInput.addEventListener('input', debounce(filterAndRender));
        });
    </script>
</body>
</html>
